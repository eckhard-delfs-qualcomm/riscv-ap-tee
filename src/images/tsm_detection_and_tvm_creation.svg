<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2050" height="2119"><desc>title%20TSM%20detection%20and%20TVM%20creation%0A%0AHost-%3ETSM%3A%20Get%20TSM%20information%0ATSM-%3EHost%3A%20TSM%20state%20and%20TVM%20configuration%20data%0AHost-%3EHost%3A%20Verify%20that%20TSM%20is%20in%20%22TSM_READY%22%0Aalt%20TSM%20in%20TSM_READY%20state%0AHost-%3ETSM%3A%20Begin%20conversion%20of%20non-confidential%20pages%20to%20confidential%20pages%0AHost-%3ETSM%3A%20Intiate%20global%20fence%20operation%0AHost-%3EHost%3A%20Issue%20TLB%20invalidation%20IPIs%20to%20all%20CPUs%2Fharts%0Aloop%20%232f2e7b%20On%20all%20platform%20CPUs%2Fharts%0AHost-%3ETSM%3A%20Initiate%20local%20fence%20operation%0Aend%0ATSM--%3ETSM%3A%20Update%20status%20for%20converted%20confidential-page%0AHost-%3ETSM%3A%20Create%20TVM%0AHost-%3E*TVM%3A%3C%3Ccreate%3E%3E%0ATSM-%3ETSM%3A%20Set%20TVM%20state%20to%20TVM_INITIALIZING%0ATSM-%3EHost%3A%20TVM%20%22guest_id%22%0AHost-%3ETSM%3A%20Donate%20converted%20confidential%20pages%20for%20TVM%20page-table%20pool%0ATSM-%3ETSM%3A%20Update%20TVM%20page-table%20pool%0AHost-%3ETSM%3A%20Create%20confidential%20memory%20regions%0AHost-%3ETSM%3A%20Add%20TVM%20code%20and%20data%20pages%0ATSM-%3ETSM%3A%20Copy%20TVM%20code%20and%20data%20pages%20from%20non-confidential%20memory%20to%20confidential%20memory%0ATSM-%3ETSM%3A%20Update%20TVM%20measurement%0ATSM-%3ETSM%3A%20Map%20confidential%20pages%20to%20TVM-GPA%0Aloop%20On%20all%20platform%20CPUs%2Fharts%20to%20be%20added%20to%20TVM%0Anote%20over%20Host%2CTSM%3A%20The%20TSM%20communicates%20with%20the%20host%20using%20a%20per-VCPU%20shared-memory%20region.%20The%20is%20dynamically%20sized%20on%20the%20platform%20and%20can%20be%20enumerated.%20%0AHost%3C-%3ETSM%3A%20Get%20per-VCPU%20shared-memory%20allocation%20for%20TVM-state%0AHost-%3ETSM%3A%20Add%20platform%20CPU(s)%20to%20TVM%0Anote%20over%20Host%2CTSM%3A%20The%20host%20can%20add%20one%20or%20more%20platform%20CPUs%20to%20the%20TVM%2C%20and%20one%20VCPU%20is%20nominated%20to%20act%20as%20the%20boot%20VCPU%0ATSM-%3ETSM%3A%20Add%20VCPU%20to%20TVM%0Aend%0Anote%20over%20Host%2CTSM%3A%20The%20host%20is%20expected%20to%20set%20the%20entry%20point%20and%20initialization%20parameter%20information%0AHost-%3ETSM%3A%20Set%20TVM%20entry%20point%20and%20other%20configuration%20registers%20on%20boot%20VCPU%0ATSM-%3ETSM%3A%20Extend%20TVM%20measurements%20with%20entry%20point%20and%20initialization%20parameter%20information%0AHost-%3ETSM%3A%20Finalize%20TVM%0ATSM-%3ETSM%3A%20Lock%20TVM%20measurements%0ATSM-%3ETSM%3A%20Set%20TVM%20state%20to%20TVM_RUNNABLE%0AHost-%3ETSM%3A%20Run%20TVM%20using%20boot%20VCPU%0ATSM-%3ETVM%3A%20Begin%20execution%20on%20boot%20VCPU%0Aloop%20%232f2e7b%0ATVM-%3ETVM%3A%20Begin%20execution%20loop%0Aend%0Aend</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2050" height="2119"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="847.056215718457" y="22.6179738" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TSM detection and TVM creation</text></g><g><rect fill="rgb(213,213,229)" stroke="none" x="30.157298400000002" y="451.90711652400006" width="1197.1403019984375" height="82.9325705999999"/><rect fill="rgb(213,213,229)" stroke="none" x="1786.4578965890623" y="1941.2252980080002" width="234.37501354746087" height="102.53481456000009"/></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 88.511670804 L 82.9325706 2119.1533585680004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 88.511670804 L 1174.5223281984374 2119.1533585680004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1839.2331687890623 704.776063608 L 1839.2331687890623 2119.1533585680004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 49.866681255841804 47.799317964000004 L 115.99845994415821 47.799317964000004 L 115.99845994415821 88.511670804 L 49.866681255841804 88.511670804 L 49.866681255841804 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="66.2270156378418" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Host</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1142.6953275948188 47.799317964000004 L 1206.349328802056 47.799317964000004 L 1206.349328802056 88.511670804 L 1142.6953275948188 88.511670804 L 1142.6953275948188 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1159.0556619768188" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TSM</text></g></g><g><g><g><rect fill="white" stroke="none" x="550.9156489674609" y="118.668969204" width="155.62360086351563" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="553.1774463474609" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Get TSM information</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 138.27121316400002 L 1162.1075736904374 138.27121316400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,138.27121316400002) translate(-1174.5223281984374,-138.27121316400002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 131.98844266400002 L 1174.5223281984374 138.27121316400002 L 1161.9567871984375 144.55398366400001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="485.9323115651171" y="160.889186964" width="285.5902756682031" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="488.19410894511714" y="174.459971244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TSM state and TVM configuration data</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 180.491430924 L 95.347325108 180.491430924" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(82.9325706,180.491430924) translate(-82.9325706,-180.491430924)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 95.4981116 174.20866042400002 L 82.9325706 180.491430924 L 95.4981116 186.774201424 Z"/></g></g><g><g><rect fill="white" stroke="none" x="100.77563882" y="203.109404724" width="256.02359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="103.0374362" y="216.680189004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Verify that TSM is in "TSM_READY"</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 222.711648684 L 143.24716740000002 222.711648684 L 143.24716740000002 242.31389264400002 L 95.347325108 242.31389264400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(82.9325706,242.31389264400002) translate(-82.9325706,-242.31389264400002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 95.4981116 236.03112214400002 L 82.9325706 242.31389264400002 L 95.4981116 248.59666314400002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="387.9323115651171" y="305.64421928400003" width="481.5902756682031" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="390.19410894511714" y="319.2150035640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Begin conversion of non-confidential pages to confidential pages</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 325.24646324400004 L 1162.1075736904374 325.24646324400004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,325.24646324400004) translate(-1174.5223281984374,-325.24646324400004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 318.963692744 L 1174.5223281984374 325.24646324400004 L 1161.9567871984375 331.52923374400007 Z"/></g></g><g><g><rect fill="white" stroke="none" x="517.9712062184375" y="347.86443704400006" width="221.5124863615625" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="520.2330035984374" y="361.43522132400005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Intiate global fence operation</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 367.46668100400007 L 1162.1075736904374 367.46668100400007" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,367.46668100400007) translate(-1174.5223281984374,-367.46668100400007)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 361.18391050400004 L 1174.5223281984374 367.46668100400007 L 1161.9567871984375 373.7494515040001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="100.77563882" y="390.084654804" width="320.42358865648436" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="103.0374362" y="403.655439084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Issue TLB invalidation IPIs to all CPUs/harts</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 409.68689876400003 L 143.24716740000002 409.68689876400003 L 143.24716740000002 429.28914272400004 L 95.347325108 429.28914272400004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(82.9325706,429.28914272400004) translate(-82.9325706,-429.28914272400004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 95.4981116 423.006372224 L 82.9325706 429.28914272400004 L 95.4981116 435.57191322400007 Z"/></g></g><g><g><rect fill="rgb(213,213,229)" stroke="none" x="521.21009782" y="492.619469364" width="215.0347031584375" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="523.4718952" y="506.190253644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate local fence operation</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 512.221713324 L 1162.1075736904374 512.221713324" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,512.221713324) translate(-1174.5223281984374,-512.221713324)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 505.938942824 L 1174.5223281984374 512.221713324 L 1161.9567871984375 518.504483824 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="557.4576609239999" width="343.79025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="571.0284452039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Update status for converted confidential-page</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 577.0599048839999 L 1234.8369249984376 577.0599048839999 L 1234.8369249984376 596.662148844 L 1186.9370827064374 596.662148844" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(1174.5223281984374,596.662148844) translate(-1174.5223281984374,-596.662148844)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 590.379378344 L 1174.5223281984374 596.662148844 L 1187.0878691984374 602.9449193439999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="583.9323191945117" y="619.2801226439999" width="89.59026040941406" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="586.1941165745117" y="632.8509069239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create TVM</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 638.8823666039999 L 1162.1075736904374 638.8823666039999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,638.8823666039999) translate(-1174.5223281984374,-638.8823666039999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 632.5995961039999 L 1174.5223281984374 638.8823666039999 L 1161.9567871984375 645.1651371039999 Z"/></g></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1807.0450565445135 662.7820255859999 L 1871.4212810336112 662.7820255859999 L 1871.4212810336112 703.4943784259999 L 1807.0450565445135 703.4943784259999 L 1807.0450565445135 662.7820255859999 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1823.4053909265135" y="688.4157292259998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TVM</text></g><g><g><rect fill="white" stroke="none" x="894.8659055050009" y="663.5359580459999" width="100.24581613451171" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="897.1277028850009" y="677.1067423259999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">&lt;&lt;create&gt;&gt;</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 683.1382020059999 L 1794.6303020365135 683.1382020059999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1807.0450565445135,683.1382020059999) translate(-1807.0450565445135,-683.1382020059999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1794.4795155445136 676.855431506 L 1807.0450565445135 683.1382020059999 L 1794.4795155445136 689.4209725059999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="727.3940374079999" width="261.9902695646875" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="740.9648216879999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Set TVM state to TVM_INITIALIZING</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 746.9962813679999 L 1234.8369249984376 746.9962813679999 L 1234.8369249984376 766.5985253279999 L 1186.9370827064374 766.5985253279999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,766.5985253279999) translate(-1174.5223281984374,-766.5985253279999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 760.315754828 L 1174.5223281984374 766.5985253279999 L 1187.0878691984374 772.8812958279999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="570.6823191945117" y="789.2164991279999" width="116.09026040941406" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="572.9441165745117" y="802.7872834079999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TVM "guest_id"</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 808.8187430879999 L 95.347325108 808.8187430879999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(82.9325706,808.8187430879999) translate(-82.9325706,-808.8187430879999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 95.4981116 802.5359725879999 L 82.9325706 808.8187430879999 L 95.4981116 815.1015135879999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="400.048980266289" y="831.4367168879999" width="457.35693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="402.310777646289" y="845.0075011679999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Donate converted confidential pages for TVM page-table pool</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 851.0389608479999 L 1162.1075736904374 851.0389608479999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,851.0389608479999) translate(-1174.5223281984374,-851.0389608479999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 844.7561903479999 L 1174.5223281984374 851.0389608479999 L 1161.9567871984375 857.3217313479998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="873.6569346479998" width="213.7235917082422" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="887.2277189279998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Update TVM page-table pool</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 893.2591786079998 L 1234.8369249984376 893.2591786079998 L 1234.8369249984376 912.8614225679999 L 1186.9370827064374 912.8614225679999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,912.8614225679999) translate(-1174.5223281984374,-912.8614225679999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 906.5786520679999 L 1174.5223281984374 912.8614225679999 L 1187.0878691984374 919.1441930679998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="494.36564591570306" y="935.4793963679998" width="268.72360696703123" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="496.6274432957031" y="949.0501806479998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create confidential memory regions</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 955.0816403279998 L 1162.1075736904374 955.0816403279998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,955.0816403279998) translate(-1174.5223281984374,-955.0816403279998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 948.7988698279999 L 1174.5223281984374 955.0816403279998 L 1161.9567871984375 961.3644108279998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="514.6212077443164" y="977.6996141279998" width="228.2124833098047" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="516.8830051243164" y="991.2703984079998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Add TVM code and data pages</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 997.3018580879998 L 1162.1075736904374 997.3018580879998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,997.3018580879998) translate(-1174.5223281984374,-997.3018580879998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 991.0190875879998 L 1174.5223281984374 997.3018580879998 L 1161.9567871984375 1003.5846285879998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="1019.9198318879999" width="641.590245150625" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="1033.4906161679999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Copy TVM code and data pages from non-confidential memory to confidential memory</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 1039.522075848 L 1234.8369249984376 1039.522075848 L 1234.8369249984376 1059.1243198079999 L 1186.9370827064374 1059.1243198079999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1059.1243198079999) translate(-1174.5223281984374,-1059.1243198079999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 1052.841549308 L 1174.5223281984374 1059.1243198079999 L 1187.0878691984374 1065.4070903079999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="1081.742293608" width="200.97914590746095" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="1095.313077888" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Update TVM measurement</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 1101.344537568 L 1234.8369249984376 1101.344537568 L 1234.8369249984376 1120.946781528 L 1186.9370827064374 1120.946781528" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1120.946781528) translate(-1174.5223281984374,-1120.946781528)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 1114.664011028 L 1174.5223281984374 1120.946781528 L 1187.0878691984374 1127.229552028 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="1143.564755328" width="266.0791367521875" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="1157.135539608" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Map confidential pages to TVM-GPA</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 1163.1669992880002 L 1234.8369249984376 1163.1669992880002 L 1234.8369249984376 1182.769243248 L 1186.9370827064374 1182.769243248" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1182.769243248) translate(-1174.5223281984374,-1182.769243248)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 1176.486472748 L 1174.5223281984374 1182.769243248 L 1187.0878691984374 1189.052013748 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 69.36178632000001 1246.099569888 L 1174.5223281984374 1246.099569888 L 1188.0931124784374 1259.670354168 L 1188.0931124784374 1280.780463048 L 69.36178632000001 1280.780463048 L 69.36178632000001 1246.099569888 M 1174.5223281984374 1246.099569888 L 1174.5223281984374 1259.670354168 L 1188.0931124784374 1259.670354168" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.47189519999995" y="1267.209678768" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The TSM communicates with the host using a per-VCPU shared-memory region. The is dynamically sized on the platform and can be enumerated. </text></g><g><g><rect fill="white" stroke="none" x="426.80453446550774" y="1303.398436848" width="403.84582986742186" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="429.06633184550776" y="1316.969221128" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Get per-VCPU shared-memory allocation for TVM-state</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 95.347325108 1323.000680808 L 1162.1075736904374 1323.000680808" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1323.000680808) translate(-1174.5223281984374,-1323.000680808)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 1316.717910308 L 1174.5223281984374 1323.000680808 L 1161.9567871984375 1329.283451308 Z"/><g transform="translate(82.9325706,1323.000680808) translate(-82.9325706,-1323.000680808)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 95.4981116 1316.717910308 L 82.9325706 1323.000680808 L 95.4981116 1329.283451308 Z"/></g></g></g><g><g><rect fill="white" stroke="none" x="524.1100993458789" y="1345.618654608" width="209.2347001066797" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="526.3718967258789" y="1359.189438888" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Add platform CPU(s) to TVM</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 1365.220898568 L 1162.1075736904374 1365.220898568" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1365.220898568) translate(-1174.5223281984374,-1365.220898568)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 1358.938128068 L 1174.5223281984374 1365.220898568 L 1161.9567871984375 1371.503669068 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 69.36178632000001 1387.8388723679998 L 1174.5223281984374 1387.8388723679998 L 1188.0931124784374 1401.4096566479998 L 1188.0931124784374 1422.5197655279999 L 69.36178632000001 1422.5197655279999 L 69.36178632000001 1387.8388723679998 M 1174.5223281984374 1387.8388723679998 L 1174.5223281984374 1401.4096566479998 L 1188.0931124784374 1401.4096566479998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="224.98300359843745" y="1408.9489812479999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The host can add one or more platform CPUs to the TVM, and one VCPU is nominated to act as the boot VCPU</text></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="1445.137739328" width="133.16803445726563" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="1458.708523608" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Add VCPU to TVM</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 1464.739983288 L 1234.8369249984376 1464.739983288 L 1234.8369249984376 1484.342227248 L 1186.9370827064374 1484.342227248" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1484.342227248) translate(-1174.5223281984374,-1484.342227248)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 1478.059456748 L 1174.5223281984374 1484.342227248 L 1187.0878691984374 1490.624997748 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 69.36178632000001 1529.578174848 L 1174.5223281984374 1529.578174848 L 1188.0931124784374 1543.148959128 L 1188.0931124784374 1564.259068008 L 69.36178632000001 1564.259068008 L 69.36178632000001 1529.578174848 M 1174.5223281984374 1529.578174848 L 1174.5223281984374 1543.148959128 L 1188.0931124784374 1543.148959128" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="323.21078680156245" y="1550.688283728" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The host is expected to set the entry point and initialization parameter information</text></g><g><g><rect fill="white" stroke="none" x="377.4545436207812" y="1586.877041808" width="502.545811556875" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="379.7163410007812" y="1600.447826088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Set TVM entry point and other configuration registers on boot VCPU</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 1606.479285768 L 1162.1075736904374 1606.479285768" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1606.479285768) translate(-1174.5223281984374,-1606.479285768)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 1600.196515268 L 1174.5223281984374 1606.479285768 L 1161.9567871984375 1612.762056268 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="1629.097259568" width="625.8124741545313" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="1642.668043848" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Extend TVM measurements with entry point and initialization parameter information</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 1648.6995035280002 L 1234.8369249984376 1648.6995035280002 L 1234.8369249984376 1668.301747488 L 1186.9370827064374 1668.301747488" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1668.301747488) translate(-1174.5223281984374,-1668.301747488)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 1662.018976988 L 1174.5223281984374 1668.301747488 L 1187.0878691984374 1674.584517988 Z"/></g></g><g><g><rect fill="white" stroke="none" x="580.9989848439258" y="1690.9197212880001" width="95.45692911058593" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="583.2607822239257" y="1704.4905055680001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Finalize TVM</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 1710.521965248 L 1162.1075736904374 1710.521965248" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1710.521965248) translate(-1174.5223281984374,-1710.521965248)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 1704.239194748 L 1174.5223281984374 1710.521965248 L 1161.9567871984375 1716.804735748 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="1733.139939048" width="188.95692911058595" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="1746.710723328" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Lock TVM measurements</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 1752.7421830080002 L 1234.8369249984376 1752.7421830080002 L 1234.8369249984376 1772.344426968 L 1186.9370827064374 1772.344426968" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1772.344426968) translate(-1174.5223281984374,-1772.344426968)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 1766.0616564680001 L 1174.5223281984374 1772.344426968 L 1187.0878691984374 1778.627197468 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1192.3653964184375" y="1794.9624007680002" width="250.24582376390626" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.6271937984375" y="1808.5331850480002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Set TVM state to TVM_RUNNABLE</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 1814.5646447280003 L 1234.8369249984376 1814.5646447280003 L 1234.8369249984376 1834.1668886880002 L 1186.9370827064374 1834.1668886880002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1834.1668886880002) translate(-1174.5223281984374,-1834.1668886880002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1187.0878691984374 1827.8841181880002 L 1174.5223281984374 1834.1668886880002 L 1187.0878691984374 1840.4496591880002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="530.9823222462695" y="1856.7848624880003" width="195.49025430589845" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="533.2441196262695" y="1870.3556467680003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Run TVM using boot VCPU</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.9325706 1876.3871064480002 L 1162.1075736904374 1876.3871064480002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1174.5223281984374,1876.3871064480002) translate(-1174.5223281984374,-1876.3871064480002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1161.9567871984375 1870.1043359480002 L 1174.5223281984374 1876.3871064480002 L 1161.9567871984375 1882.6698769480001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1393.0659480619922" y="1899.0050802480002" width="227.62360086351563" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1395.3277454419922" y="1912.5758645280002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Begin execution on boot VCPU</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1174.5223281984374 1918.6073242080001 L 1826.8184142810624 1918.6073242080001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1839.2331687890623,1918.6073242080001) translate(-1839.2331687890623,-1918.6073242080001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1826.6676277890624 1912.3245537080002 L 1839.2331687890623 1918.6073242080001 L 1826.6676277890624 1924.890094708 Z"/></g></g><g><g><rect fill="rgb(213,213,229)" stroke="none" x="1857.0762370090624" y="1981.9376508480002" width="158.47914590746095" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1859.3380343890624" y="1995.5084351280002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Begin execution loop</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1839.2331687890623 2001.5398948080003 L 1899.5477655890622 2001.5398948080003 L 1899.5477655890622 2021.1421387680002 L 1851.6479232970623 2021.1421387680002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1839.2331687890623,2021.1421387680002) translate(-1839.2331687890623,-2021.1421387680002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1851.7987097890623 2014.8593682680003 L 1839.2331687890623 2021.1421387680002 L 1851.7987097890623 2027.4249092680002 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 15.078649200000001 264.93186644400004 L 2035.9115593365232 264.93186644400004 L 2035.9115593365232 2066.3780863680004 L 15.078649200000001 2066.3780863680004 L 15.078649200000001 264.93186644400004 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 15.078649200000001 264.93186644400004 L 15.078649200000001 283.026245484 L 62.79150294362793 283.026245484 L 71.83869246362794 273.97905596400005 L 71.83869246362794 264.93186644400004 L 15.078649200000001 264.93186644400004" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="30.157298400000002" y="276.994785804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><g><rect fill="white" stroke="none" x="84.65554428362793" y="266.13815838" width="179.63470926195313" height="15.681795168000004"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="86.91734166362794" y="276.994785804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[TSM in TSM_READY state]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 30.157298400000002 451.90711652400006 L 1227.2976003984375 451.90711652400006 L 1227.2976003984375 534.839687124 L 30.157298400000002 534.839687124 L 30.157298400000002 451.90711652400006 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="#2f2e7b" stroke="black" paint-order="fill stroke markers" d=" M 30.157298400000002 451.90711652400006 L 30.157298400000002 470.00149556400004 L 88.87015214362793 470.00149556400004 L 97.91734166362794 460.9543060440001 L 97.91734166362794 451.90711652400006 L 30.157298400000002 451.90711652400006" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="45.2359476" y="463.970035884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">loop</text><g><rect fill="rgb(213,213,229)" stroke="none" x="110.73419348362793" y="453.11340846" width="191.64581766039063" height="15.681795168000004"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="112.99599086362794" y="463.970035884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[On all platform CPUs/harts]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 30.157298400000002 1205.3872170480001 L 1330.810958095703 1205.3872170480001 L 1330.810958095703 1506.960201048 L 30.157298400000002 1506.960201048 L 30.157298400000002 1205.3872170480001 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 30.157298400000002 1205.3872170480001 L 30.157298400000002 1223.481596088 L 88.87015214362793 1223.481596088 L 97.91734166362794 1214.4344065680002 L 97.91734166362794 1205.3872170480001 L 30.157298400000002 1205.3872170480001" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="45.2359476" y="1217.4501364080002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">loop</text><g><rect fill="white" stroke="none" x="110.73419348362793" y="1206.5935089840002" width="325.6347092619531" height="15.681795168000004"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="112.99599086362794" y="1217.4501364080002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[On all platform CPUs/harts to be added to TVM]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1786.4578965890623 1941.2252980080002 L 2020.8329101365232 1941.2252980080002 L 2020.8329101365232 2043.7601125680003 L 1786.4578965890623 2043.7601125680003 L 1786.4578965890623 1941.2252980080002 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="#2f2e7b" stroke="black" paint-order="fill stroke markers" d=" M 1786.4578965890623 1941.2252980080002 L 1786.4578965890623 1959.3196770480001 L 1845.1707503326902 1959.3196770480001 L 1854.2179398526903 1950.2724875280003 L 1854.2179398526903 1941.2252980080002 L 1786.4578965890623 1941.2252980080002" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1801.5365457890623" y="1953.2882173680002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">loop</text></g></g><g/><g/></g></svg>